<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="cs">
<head>
    <meta http-equiv="content-type" content="text/html; charset=iso-8859-2"/>
    <title>Projekt IIS</title>
    <style type="text/css">
        html {
            font-family: "BryantProRegular", 'Helvetica Neue', helvetica, arial, sans-serif, "Helvetica Neue";
        }

        body {
            max-width: 1080px;
            margin: 0 auto;
        }

        table {
            border-collapse: collapse;
        }

        td, th {
            border: 1px solid black;
            padding: 0.3em 0.5em;
            text-align: left;
        }

        dt {
            font-weight: bold;
            margin-top: 0.5em;
        }

        img {
            max-width: 100%;
            padding: 5px;
            border: 2px solid gray;
        }

        code {
            color: #a965d1;
            background-color: #a965d110;
            font-weight: bold;
            padding: 2px;
            display: inline-block;
        }

        pre {
            color: #a965d1;
        }

        p {
            text-align: justify;
        }
    </style>
</head>
<body>

<!-- Zkontrolujte prosím nastavení kódování v hlavičce dokumentu 
     podle použitého editoru -->

<h1>Správa ZOO</h1>

<dl>
    <dt>Autoři</dt>
    <dd>Josef Kolář
        <a href="mailto:xkolar71@stud.fit.vutbr.cz">xkolar71@stud.fit.vutbr.cz</a> -
        architektura, modelová vrstva, dynamické komponenty, produkční nasazení
    </dd>
    <dd>Iva Kavánková
        <a href="mailto:xkavan05@stud.fit.vutbr.cz">xkavan05@stud.fit.vutbr.cz</a> -
        textace, uživatelské formuláře, testování
    </dd>
    <dd>Son Hai Nguyen
        <a href="mailto:xnguye16@stud.fit.vutbr.cz">xnguye16@stud.fit.vutbr.cz</a> -
        vizuál, řídící vrstva, testování
    </dd>
    <dt>URL aplikace</dt>
    <dd><a href="https://zis.josefkolar.cz/">https://zis.josefkolar.cz/</a></dd>
</dl>

<h2>Uživatelé systému pro testování</h2>
<p>Uveďte prosím existující zástupce <strong>všech rolí uživatelů</strong>.</p>
<table>
    <tr>
        <th>Login</th>
        <th>Heslo</th>
        <th>Role</th>
    </tr>
    <tr>
        <td>admin</td>
        <td>Zadmin</td>
        <td>Administrátor</td>
    </tr>
    <tr>
        <td>reditel</td>
        <td>Zreditel</td>
        <td>Ředitel</td>
    </tr>
    <tr>
        <td>spravce</td>
        <td>Zspravce</td>
        <td>Správce</td>
    </tr>
    <tr>
        <td>osetrovatel</td>
        <td>Zosetrovatel</td>
        <td>Ošetřovatel</td>
    </tr>
</table>
<h2>Diagram případů užití</h2>
<div>
    <a href="./use-case.png"><img src="./use-case.png" alt="Use case"></a>
</div>
<h2>Implementace</h2>
<p>
    Vzhledem k implementaci ve frameworku <i>Django</i> je struktura a architektura projektu navrhnuta dle doporučovaných
    konvencí v tomto nástroji. S využitím návrhového vzoru MVC jsou v projektu odděleny zodpovědnosti jednotlivých
    vrstev.
    Dále budou popsány jednotlivé vrstvy a jejich funkce v rámci jednotlivých případů užití plynoucích ze zadání.
</p>
<h3>Modelová vrstva</h3>
<p>
    Modelová vrstva obsahuje kompletní definici datové struktury systému, tedy třídy jako potomky
    <code>django.db.models.Model</code> reprezentující entitní množinu z pohledu ER <i>(dále jen Modely)</i>
    - existují tedy základní modely jako <code>Animals</code>, <code>Person</code>,
    <code>Enclosure</code> či <code>Feeding</code>, resp. <code>Cleaning</code>. Mezi těmito základními modely jsou
    poté navázané různé relační modely, například přiřazení osoby k čištění <code>CleaningPerson</code> či <code>AnimalStay</code>,
    jakožto model reprezentující zařazení zvířete ve výběhu. Definice všech modelů, jakožto tříd, jsou umístěny
    strukturovaně v balíčku <code>ziscz/core/models/</code>.
</p>
<p>
    Jednotlivé atributy modelů (entitních množin) jsou nejčastěji definovány společně se svými datovými omezeními, tedy
    např. pro délku čištění/krmení je definován atribut <code>length</code> přímo s validátorem na minimální délku
    trvání 15 minut, stejně jako se svou výchozí hodnotou a přeloženým popiskem pro další použití:
</p>
<pre>
length = models.<strong>DurationField</strong>(
    verbose_name=<strong>_('Length')</strong>,
    validators=[<strong>MinValueValidator(timedelta(minutes=15))</strong>],
    default=<strong>timedelta(minutes=15)</strong>,
)
</pre>
<p>
    Takto definované atributy díky frameworku Django zajištují i validace na úrovni formulářů, o kterých bude zmínka
    dále.
</p>
<p>
    Taktéž tento framework zajištuje verzování databázového schématu pomocí migrací, tedy i multiplatformnost z hlediska
    SŘBD včetně generování skriptů v jazyce SQL pro úpravu schématu - to vše pro konzistentní chování objektově
    relačního mapováním nad definovanými modely. Níže jejich struktura: <i>(pro přehlednost nejsou zahrnuty číselníkové
    modely, jako je typ role osoby, zvířete či výběhu)</i>.
</p>

<div>
    <a href="./models.png"><img src="./models.png" alt="Modely"></a>
</div>


<h3>Prezentační vrstva</h3>
<p>
    Prezentační vrstva se z pohledu použitého frameworku zúžuje především na šablony v šablonovacím jazyce <i>Django
    Templates</i> - v zásadě není tento jazyk omezený na generování konkrétního jazyka, v případě tohoto projektu je
    ovšem generováno standardní HTML. V projektu jsou šablony umístěny ve složkách s příznačným názvem
    <code>templates/</code>.
</p>
<p>
    S prezentační vrstvou jsou spjaty veškeré formuláře pro vytváření a úpravu jednotlivých entit v systému. Díky
    frameworku je s pomocí třídy <code>django.forms.ModelForm</code> možno tyto formuláře přímo generovat z definice
    jednotlivých modelů. Z pohledu případů užití jsou tyto formuláře podmínkou pro splnění případů užití týkající se
    jednoduché úpravy zvířat/výběhů/osob, stejně tak jako plánování čištění a krmení.
</p>
<p>
    Pro zjednodušení uživatelského rozhraní jsou pro některé případy použití využity komponenty v jazyce Javascript.
    Především se jedná o kalendář (JS komonenta <code>FullCalendar</code>), který je díky této technologii schopen
    zobrazovat dynamicky přehledy jednotlivých dnů, týdnů i měsíců a taktéž pro uživatele s dostatečnými právy umožnit
    přímé plánování jednotlivých událostí - tedy editovat začátky a délky. Pro dynamické plánování opakovaných událostí
    a přemístování zvířat mezi výběhy jsou poté použity komponenty ve frameworku <code>Vue.js</code>.
</p>

<h3>Řídící vrstva</h3>

<p>
    Django tuto vrstvu realizuje v takzvaných pohledech, potomky třídy <code>View</code>.
    V této vrstvě se odehrává většina exekutivních operací nad entitami v systému. Ve velkém množství zde projekt
    využívá generických tříd pocházejících z frameworku. Jedná se především o trojici tříd
    <code>django.views.generic.ListView, CreateView, UpdateView</code>. První zmíněná podporuje deklarativní definici
    výpisu obsahu jednotlivých modelů - v tomto případě výpis seznamu zvířat <code>AnimalListView</code> nebo osob
    <code>PersonListView</code>.
</p>

<p>
    Zbylé dvě jsou úzce spjaty s definovanými formuláři popsanými výše - obě jsou schopny dle definice modelu a šablony
    vykreslovat a zpracovávat formuláře pro vytvoření, resp. upravení dat konkrétní entity.
</p>

<h2>Instalace</h2>
<ul>
    <li>
        Pro vývoj jsou zapotřebí následující technologie/nástroje:
        <ul>
            <li><code>Python</code> ve verzi 3.5 či vyšší</li>
            <li><code>PostgreSQL</code> 9.6 či vyšší <i>(alternativně jiný SŘBD, bez záruky MySQL ši SQLite)</i></li>
            <li><code>npm</code> >= 6.1.0</li>
            <li><code>node</code> >= 9.11.2</li>
        </ul>
        Pro produkční použití jsou následně doporučovány služby <code>gunicorn</code> a <code>nginx</code>.
    </li>
    <li>
        Vzhledem k implementaci v jazyce Python 3 je doporučeno vytvořit virtuální prostředí a aktivovat jej:
        <code>$ pyvenv .venv && . .venv/bin/activate</code>.
    </li>
    <li>
        Do aktivního prostředí je následně nutné nainstalovat projekt se všemi jeho závislostmi:
        <code>$ pip install .</code>.
    </li>
    <li>
        Poté nainstalovat i frontend závislosti projektu: <code>$ npm ci</code> a sestavit balíčky pro frontend:
        <code>$ npm run build</code>.
    </li>
    <li>
        Dle souboru s šablonou pro Django nastavení <code>settings.py.template</code> vytvořte soubor
        <code>settings.py</code>, do kterého nastavte údaje pro připojení k databázi a vygenerujte náhodný klíč.
    </li>
    <li>
        Inicializaci schématu databáze lze provést pomocí migrací, v aktivovaném virtuálním prostředí:
        <code>PYTHONPATH=. python ./ziscz/manage.py migrate</code>.
    </li>
    <li>
        Pro prvotní práci je vhodné vložit účet pro administrátora - superuživatele:
        <code>PYTHONPATH=. python ./ziscz/manage.py createsuperuser</code>.
    </li>
    <li>
        Vložení základných číselníkových hodnot zajistí následující příkaz:
        <code>PYTHONPATH=. python ./ziscz/manage.py loaddata base</code>.
    </li>
    <li>
        Následující příkaz poté spustí vývojářský server
        <code>PYTHONPATH=. python ./ziscz/manage.py runserver</code>.
    </li>
</ul>

<h2>Známé problémy</h2>
<p>
    Zde popište, které body zadání (IDS a IIS) nejsou implementovány a z jakého důvodu. Např. &bdquo;Z časových důvodů
    nebyla implementována správa uživatelů.&rdquo; Pomůžete tím zrychlit opravování, když neimplementované funkce
    nebudeme muset dlouze hledat.
</p>

</body>
</html>
